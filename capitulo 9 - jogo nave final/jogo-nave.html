<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Nave</title>

    <script src="js/animacao.js"></script>
    <script src="js/teclado.js"></script>
    <script src="js/colisor.js"></script>
    <script src="js/fundo.js"></script>
    <script src="js/nave.js"></script>
    <script src="js/ovni.js"></script>
    <script src="js/tiro.js"></script>
</head>

<body>
    <canvas id="canvas_animacao" width="500" height="500">
    </canvas>
    <script>
        // Canvas e Context
        const canvas = document.getElementById('canvas_animacao');
        const context = canvas.getContext('2d');

        // Variáveis principais
        let imagens, animacao, teclado, colisor, nave, criadorInimigos;
        let totalImagens = 0, carregadas = 0;

        // Começa carregando as imagens
        carregarImagens();

        function carregarImagens() {

            // Objeto contendo os nomes das imagens
            imagens = {
                espaco: 'fundo-espaco.png',
                estrelas: 'fundo-estrelas.png',
                nuvens: 'fundo-nuvens.png',
                nave: 'nave.png',
                ovni: 'ovni.png'
            };

            // Carregar todas
            for (let i in imagens) {
                let img = new Image();
                img.src = 'img/' + imagens[i];
                img.onload = carregando;
                totalImagens++;
                // Substituir o nome pelo objeto imagem
                imagens[i] = img;
            }
        }

        function carregando() {
            carregadas++;
            if (carregadas == totalImagens) {
                iniciarObjetos();
            }
        }

        function iniciarObjetos() {
            // Objetos principais
            animacao = new Animacao(context);
            teclado = new Teclado(document);
            colisor = new Colisor();
            espaco = new Fundo(context, imagens.espaco);
            estrelas = new Fundo(context, imagens.estrelas);
            nuvens = new Fundo(context, imagens.nuvens);
            nave = new Nave(context, teclado, imagens.nave);

            // Ligações entre objetos
            animacao.novoSprite(espaco);
            animacao.novoSprite(estrelas);
            animacao.novoSprite(nuvens);
            animacao.novoSprite(nave);

            colisor.novoSprite(nave);
            animacao.novoProcessamento(colisor);

            configuracoesIniciais();

        }

        function configuracoesIniciais() {
            // Fundos
            espaco.velocidade = 3;
            estrelas.velocidade = 5;
            nuvens.velocidade = 10;

            // Nave
            nave.x = canvas.width / 2 - imagens.nave.width / 2;
            nave.y = canvas.height - imagens.nave.height;
            nave.velocidade = 5;

            // Tiro
            teclado.disparou(ESPACO, function () {
                nave.atirar();
            });

            animacao.ligar();
        }
    </script>
</body>

</html>